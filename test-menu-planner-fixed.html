<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shef's Fiery Kitchen - Menu Planner</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        nav {
            background: #2d3748;
            padding: 0;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }

        nav button {
            background: none;
            border: none;
            color: white;
            padding: 15px 30px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }

        nav button:hover {
            background: #4a5568;
        }

        nav button.active {
            background: #4a5568;
            border-bottom-color: #f5576c;
        }

        .page {
            display: none;
            padding: 30px;
        }

        .page.active {
            display: block;
        }

        .date-range {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .date-range label {
            font-weight: bold;
            color: #2d3748;
        }

        .date-range input {
            padding: 10px;
            border: 2px solid #cbd5e0;
            border-radius: 5px;
            font-size: 1em;
        }

        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .recipe-card {
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .recipe-card.selected {
            border-color: #f5576c;
            background: #fff5f7;
        }

        .recipe-card h3 {
            color: #2d3748;
            margin-bottom: 10px;
        }

        .recipe-card p {
            color: #718096;
            font-size: 0.9em;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .menu-display {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .menu-display h3 {
            color: #2d3748;
            margin-bottom: 15px;
        }

        .menu-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }

        .shopping-list {
            margin-top: 20px;
        }

        .recipe-section {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .recipe-section h4 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .ingredient-list {
            list-style: none;
            padding-left: 0;
        }

        .ingredient-list li {
            padding: 8px;
            border-bottom: 1px solid #e2e8f0;
        }

        .totals-section {
            background: #fff5f7;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #f5576c;
        }

        .totals-section h3 {
            color: #f5576c;
            margin-bottom: 15px;
        }

        .inventory-section {
            margin-top: 30px;
        }

        .inventory-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .inventory-item {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }

        .inventory-item label {
            display: block;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .inventory-item input {
            width: 100%;
            padding: 8px;
            border: 2px solid #cbd5e0;
            border-radius: 5px;
            font-size: 1em;
        }

        .saved-menus-list {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .saved-menu-card {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .saved-menu-info h4 {
            color: #2d3748;
            margin-bottom: 5px;
        }

        .saved-menu-info p {
            color: #718096;
            font-size: 0.9em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .success {
            background: #c6f6d5;
            color: #22543d;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #718096;
        }

        .modal-close:hover {
            color: #2d3748;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üî• Shef's Fiery Kitchen</h1>
            <p>Menu Planner & Shopping List</p>
        </header>

        <nav>
            <button class="nav-btn active" data-page="select-recipes">Select Recipes</button>
            <button class="nav-btn" data-page="shopping-list">Shopping List</button>
            <button class="nav-btn" data-page="inventory">Ingredient Inventory</button>
            <button class="nav-btn" data-page="saved-menus">Saved Menus</button>
        </nav>

        <!-- Select Recipes Page -->
        <div id="select-recipes" class="page active">
            <h2>Create Your Menu</h2>
            
            <div class="date-range">
                <div>
                    <label>Start Date:</label>
                    <input type="date" id="start-date">
                </div>
                <div>
                    <label>End Date:</label>
                    <input type="date" id="end-date">
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn-primary" onclick="viewCurrentMenu()">üëÅÔ∏è View Menu</button>
                <button class="btn-primary" onclick="saveMenu()">üíæ Save Menu</button>
                <button class="btn-secondary" onclick="clearSelection()">üóëÔ∏è Clear Selection</button>
            </div>

            <div id="recipes-loading" class="loading">Loading recipes...</div>
            <div id="recipes-container" class="recipe-grid"></div>
        </div>

        <!-- Shopping List Page -->
        <div id="shopping-list" class="page">
            <h2>Shopping List</h2>
            <div id="shopping-list-content">
                <p style="color: #718096;">Select recipes first to generate your shopping list.</p>
            </div>
        </div>

        <!-- Inventory Page -->
        <div id="inventory" class="page">
            <h2>Ingredient Inventory</h2>
            <p style="color: #718096; margin-bottom: 20px;">Track what you already have in stock. This will help calculate what you need to buy.</p>
            
            <div class="action-buttons">
                <button class="btn-primary" onclick="saveInventory()">üíæ Save Inventory</button>
                <button class="btn-secondary" onclick="loadInventory()">üîÑ Refresh</button>
            </div>

            <div class="inventory-section">
                <div id="inventory-loading" class="loading">Loading ingredients...</div>
                <div id="inventory-grid" class="inventory-grid"></div>
            </div>
        </div>

        <!-- Saved Menus Page -->
        <div id="saved-menus" class="page">
            <h2>Saved Menus</h2>
            <div id="saved-menus-loading" class="loading">Loading saved menus...</div>
            <div id="saved-menus-container" class="saved-menus-list"></div>
        </div>
    </div>

    <!-- View Menu Modal -->
    <div id="menu-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeMenuModal()">&times;</span>
            <div id="menu-modal-content"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://menu-planner-nu.vercel.app/api';
        
        let recipes = [];
        let ingredients = [];
        let selectedRecipes = [];
        let inventory = {};

        // Navigation
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                
                btn.classList.add('active');
                const pageId = btn.getAttribute('data-page');
                document.getElementById(pageId).classList.add('active');

                if (pageId === 'shopping-list') {
                    generateShoppingList();
                } else if (pageId === 'inventory') {
                    loadInventory();
                } else if (pageId === 'saved-menus') {
                    loadSavedMenus();
                }
            });
        });

        // Load initial data
        async function loadRecipes() {
            try {
                const response = await fetch(`${API_BASE_URL}/recipes`);
                const data = await response.json();
                recipes = data.records || [];
                displayRecipes();
            } catch (error) {
                console.error('Error loading recipes:', error);
                document.getElementById('recipes-loading').innerHTML = 
                    '<div class="error">Failed to load recipes. Please try again.</div>';
            }
        }

        async function loadIngredients() {
            try {
                const response = await fetch(`${API_BASE_URL}/ingredients`);
                const data = await response.json();
                ingredients = data.records || [];
            } catch (error) {
                console.error('Error loading ingredients:', error);
            }
        }

        function displayRecipes() {
            const container = document.getElementById('recipes-container');
            document.getElementById('recipes-loading').style.display = 'none';
            
            container.innerHTML = recipes.map(recipe => {
                const fields = recipe.fields;
                const name = fields['Recipe Name'] || fields.Name || 'Untitled Recipe';
                const prepTime = fields['Prep Time (min)'] || fields['Prep Time (minutes)'] || 'N/A';
                const spiceLevel = fields['Spice Level'] || 'N/A';
                
                return `
                    <div class="recipe-card ${selectedRecipes.includes(recipe.id) ? 'selected' : ''}" 
                         onclick="toggleRecipe('${recipe.id}')">
                        <h3>${name}</h3>
                        <p><strong>Spice Level:</strong> ${spiceLevel}</p>
                        <p><strong>Prep Time:</strong> ${prepTime} min</p>
                    </div>
                `;
            }).join('');
        }

        function toggleRecipe(recipeId) {
            const index = selectedRecipes.indexOf(recipeId);
            if (index > -1) {
                selectedRecipes.splice(index, 1);
            } else {
                selectedRecipes.push(recipeId);
            }
            displayRecipes();
        }

        function clearSelection() {
            selectedRecipes = [];
            displayRecipes();
        }

        function viewCurrentMenu() {
            if (selectedRecipes.length === 0) {
                alert('Please select at least one recipe first!');
                return;
            }

            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;

            if (!startDate || !endDate) {
                alert('Please select start and end dates!');
                return;
            }

            const menuHTML = generateMenuHTML(selectedRecipes, startDate, endDate);
            document.getElementById('menu-modal-content').innerHTML = menuHTML;
            document.getElementById('menu-modal').classList.add('active');
        }

        function generateMenuHTML(recipeIds, startDate, endDate) {
            const selectedRecipeData = recipes.filter(r => recipeIds.includes(r.id));
            
            return `
                <h2>Your Menu</h2>
                <p style="color: #718096; margin-bottom: 20px;">
                    <strong>Date Range:</strong> ${formatDate(startDate)} to ${formatDate(endDate)}
                </p>
                <div class="menu-display">
                    ${selectedRecipeData.map(recipe => {
                        const fields = recipe.fields;
                        const name = fields['Recipe Name'] || fields.Name || 'Untitled Recipe';
                        const prepTime = fields['Prep Time (min)'] || fields['Prep Time (minutes)'] || 'N/A';
                        const spiceLevel = fields['Spice Level'] || 'N/A';
                        
                        return `
                            <div class="menu-item">
                                <h3>${name}</h3>
                                <p><strong>Spice Level:</strong> ${spiceLevel}</p>
                                <p><strong>Prep Time:</strong> ${prepTime} minutes</p>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function closeMenuModal() {
            document.getElementById('menu-modal').classList.remove('active');
        }

        async function saveMenu() {
            if (selectedRecipes.length === 0) {
                alert('Please select at least one recipe first!');
                return;
            }

            const startDate = document.getElementById('start-date').value;
            const endDate = document.getElementById('end-date').value;

            if (!startDate || !endDate) {
                alert('Please select start and end dates!');
                return;
            }

            const menuName = prompt('Enter a name for this menu:');
            if (!menuName) return;

            try {
                const response = await fetch(`${API_BASE_URL}/save-menu`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: menuName,
                        startDate: startDate,
                        endDate: endDate,
                        recipes: selectedRecipes
                    })
                });

                if (response.ok) {
                    alert('Menu saved successfully!');
                    loadSavedMenus();
                } else {
                    alert('Failed to save menu. Please try again.');
                }
            } catch (error) {
                console.error('Error saving menu:', error);
                alert('Failed to save menu. Please try again.');
            }
        }

        function generateShoppingList() {
            const content = document.getElementById('shopping-list-content');
            
            if (selectedRecipes.length === 0) {
                content.innerHTML = '<p style="color: #718096;">Select recipes first to generate your shopping list.</p>';
                return;
            }

            const selectedRecipeData = recipes.filter(r => selectedRecipes.includes(r.id));
            const ingredientsByRecipe = {};
            const totalIngredients = {};

            selectedRecipeData.forEach(recipe => {
                const recipeName = recipe.fields.Name;
                ingredientsByRecipe[recipeName] = [];

                if (recipe.fields.Ingredients) {
                    recipe.fields.Ingredients.forEach(ingId => {
                        const ingredient = ingredients.find(i => i.id === ingId);
                        if (ingredient) {
                            const ingName = ingredient.fields.Name;
                            const quantity = 1; // Default quantity
                            const unit = ingredient.fields.Unit || 'unit';

                            ingredientsByRecipe[recipeName].push({
                                name: ingName,
                                quantity: quantity,
                                unit: unit
                            });

                            // Add to totals
                            if (!totalIngredients[ingName]) {
                                totalIngredients[ingName] = { quantity: 0, unit: unit };
                            }
                            totalIngredients[ingName].quantity += quantity;
                        }
                    });
                }
            });

            let html = '<div class="shopping-list">';
            
            // Per-recipe breakdown
            Object.keys(ingredientsByRecipe).forEach(recipeName => {
                html += `
                    <div class="recipe-section">
                        <h4>${recipeName}</h4>
                        <ul class="ingredient-list">
                            ${ingredientsByRecipe[recipeName].map(ing => 
                                `<li>${ing.quantity} ${ing.unit} - ${ing.name}</li>`
                            ).join('')}
                        </ul>
                    </div>
                `;
            });

            // Totals section
            html += `
                <div class="totals-section">
                    <h3>üìã Total Shopping List</h3>
                    <ul class="ingredient-list">
                        ${Object.keys(totalIngredients).map(ingName => {
                            const ing = totalIngredients[ingName];
                            const inInventory = inventory[ingName] || 0;
                            const needed = Math.max(0, ing.quantity - inInventory);
                            return `
                                <li>
                                    <strong>${ing.quantity} ${ing.unit}</strong> - ${ingName}
                                    ${inInventory > 0 ? `<br><small style="color: #48bb78;">‚úì You have ${inInventory} ${ing.unit} in inventory. Need ${needed} more.</small>` : ''}
                                </li>
                            `;
                        }).join('')}
                    </ul>
                </div>
            `;

            html += '</div>';
            content.innerHTML = html;
        }

        async function loadInventory() {
            const grid = document.getElementById('inventory-grid');
            const loading = document.getElementById('inventory-loading');
            
            if (ingredients.length === 0) {
                await loadIngredients();
            }

            loading.style.display = 'none';
            
            // Load saved inventory from localStorage
            const savedInventory = localStorage.getItem('ingredientInventory');
            if (savedInventory) {
                inventory = JSON.parse(savedInventory);
            }

            grid.innerHTML = ingredients.map(ingredient => {
                const name = ingredient.fields.Name;
                const unit = ingredient.fields.Unit || 'unit';
                const currentAmount = inventory[name] || 0;
                
                return `
                    <div class="inventory-item">
                        <label>${name}</label>
                        <input 
                            type="number" 
                            id="inv-${ingredient.id}"
                            value="${currentAmount}"
                            placeholder="Amount (${unit})"
                            step="0.1"
                            min="0"
                            data-ingredient-name="${name}"
                        >
                        <small style="color: #718096;">${unit}</small>
                    </div>
                `;
            }).join('');
        }

        function saveInventory() {
            const inputs = document.querySelectorAll('#inventory-grid input');
            const newInventory = {};
            
            inputs.forEach(input => {
                const name = input.getAttribute('data-ingredient-name');
                const amount = parseFloat(input.value) || 0;
                newInventory[name] = amount;
            });

            inventory = newInventory;
            localStorage.setItem('ingredientInventory', JSON.stringify(inventory));
            
            alert('Inventory saved successfully!');
        }

        async function loadSavedMenus() {
            const container = document.getElementById('saved-menus-container');
            const loading = document.getElementById('saved-menus-loading');
            
            try {
                const response = await fetch(`${API_BASE_URL}/menus`);
                const data = await response.json();
                const menus = data.records || [];
                
                loading.style.display = 'none';
                
                if (menus.length === 0) {
                    container.innerHTML = '<p style="color: #718096;">No saved menus yet. Create one from the Select Recipes page!</p>';
                    return;
                }

                container.innerHTML = menus.map(menu => `
                    <div class="saved-menu-card">
                        <div class="saved-menu-info">
                            <h4>${menu.fields.Name}</h4>
                            <p>${formatDate(menu.fields['Start Date'])} - ${formatDate(menu.fields['End Date'])}</p>
                            <p><small>${(menu.fields.Recipes || []).length} recipes</small></p>
                        </div>
                        <div class="action-buttons">
                            <button class="btn-primary" onclick="loadMenuToSelect('${menu.id}')">‚úèÔ∏è Edit</button>
                            <button class="btn-secondary" onclick="viewSavedMenu('${menu.id}')">üëÅÔ∏è View</button>
                            <button class="btn-danger" onclick="deleteMenu('${menu.id}')">üóëÔ∏è</button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading saved menus:', error);
                loading.innerHTML = '<div class="error">Failed to load saved menus.</div>';
            }
        }

        function loadMenuToSelect(menuId) {
            const menu = recipes.find(r => r.id === menuId);
            // This would load the menu's recipes into the select page
            // For now, switch to select recipes page
            document.querySelector('[data-page="select-recipes"]').click();
            alert('Menu editing feature coming soon!');
        }

        function viewSavedMenu(menuId) {
            alert('View saved menu feature coming soon!');
        }

        function deleteMenu(menuId) {
            if (confirm('Are you sure you want to delete this menu?')) {
                alert('Delete feature coming soon!');
            }
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        // Set default dates (today and 7 days from now)
        function setDefaultDates() {
            const today = new Date();
            const nextWeek = new Date();
            nextWeek.setDate(today.getDate() + 7);
            
            document.getElementById('start-date').valueAsDate = today;
            document.getElementById('end-date').valueAsDate = nextWeek;
        }

        // Initialize
        setDefaultDates();
        loadRecipes();
        loadIngredients();
    </script>
</body>
</html>
